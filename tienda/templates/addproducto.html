{% extends "./base_tienda.html" %}
{% block title %}
    Tienda | Nueva Publicacion
{% endblock %}

{% block meta %}
<link href="/tienda/static/css/plugins/dropzone/basic.css" rel="stylesheet">
<link href="/tienda/static/css/plugins/dropzone/dropzone.css" rel="stylesheet">
{% endblock %}

{% block direcciones %}
<div class="col-lg-10">
    <h2>Tienda</h2>
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a href="/blog/home">Home Blog</a>
        </li>
        <li class="breadcrumb-item">
            <a href="/blog/administracion/tienda">Tienda Administracion</a>
        </li>
    </ol>
</div>
<div class="col-lg-2">
</div>
{% endblock %}

{% block body %}
    <h1>Agregar Publicacion</h1>
    <div class="card">
        <div class="card-body">
            <form action="/tienda/agregar_publicacion/" method="POST"> {% csrf_token %}
                <div class="mb-3">
                    <label for="nombre" class="form-label">Nombre Producto</label>
                    <input type="text" class="form-control" maxlength="60" id="nombre_producto" name="nombre_producto" placeholder="Nombre del producto" required>
                </div>
                <div class="mb-3">
                    <label for="codigo" class="form-label">Codigo Producto</label>
                    <input type="text" class="form-control" maxlength="60" id="codigo_producto" name="codigo_producto" placeholder="Codigo del producto" required>
                </div>
                <div class="mb-3">
                    <label for="minidescrip" class="form-label">Mini Descripcion</label>
                    <input type="text" class="form-control" maxlength="60" id="minidescrip" name="minidescrip" placeholder="Pequeña descripcion, Max 60 caracteres" required>
                </div>
                <div class="mb-3">
                    <label for="descripcion" class="form-label">Descripcion</label>
                    <textarea rows="4" cols="50" type="text" class="form-control" id="descrip" name="descrip" required></textarea>
                </div>
                <div class="mb-3">
                    <label for="categoria" class="form-label">Categoria</label>
                    <input type="text" class="form-control" id="categoria" name="categoria" placeholder=" Categoria" required>
                </div>
                <div class="mb-3">
                    <label for="precio" class="form-label">Precio</label>
                    <input type="number" min="0" class="form-control" id="precio" name="precio" placeholder="Precio" required>
                </div>
                <div class="mb-3">
                    <label for="stock" class="form-label">Stock</label>
                    <input type="number" min="0" class="form-control" id="stock" name="stock" placeholder="Stock" required>
                </div>


               <div class="row">
                    <div class="col-lg-12">
                        <div class="ibox">
                            <form name="formu" id="formu" action="#" method="post" enctype="multipart/form-data">
                                <dl>            
                              <dt><label>Archivos a Subir:</label></dt>
                                        <!--Esta div contendrá todos los campos file que creemos-->
                              <dd><div id="adjuntos">
                                        <!-- Hay que prestar atención a esto, el nombre de este campo debe siempre terminar en []
                                   como un vector, y ademas debe coincidir con el nombre que se da a los campos nuevos 
                                   en el script -->
                              <input type="file" name="archivos[]" /><br />
                              </div></dd>
                              <dt><a href="#" onClick="addCampo()">Subir otro archivo</a></dt>      
                                </dl>
                           </form>
                        </div>
                    </div>
                </div>



                <div class="mb-3">
                    <label for="status" class="form-label">Status</label>
                    <select name="status" id="status" required>
                        <option value="">Seleccione Una opción</option>
                        <option value="1">Activa</option>
                        <option value="0">Inactiva</option>
                    </select>
                </div>
                <div class="form-gruop">
                    <input type="number" min="0" class="form-control" id="vendedor" name="vendedor" value="1" hidden>
                    <button type="submit" class="btn btn-success btn-block">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    
{% endblock %}

{% block scripts %}

<!-- DROPZONE -->
<script src="/tienda/static/js/plugins/dropzone/dropzone.js"></script>

<!-- CodeMirror -->
<script src="tienda/static/js/plugins/codemirror/codemirror.js"></script>
<script src="tienda/static/js/plugins/codemirror/mode/xml/xml.js"></script>

<script type="text/javascript">
    var numero = 0; //Esta es una variable de control para mantener nombres
                //diferentes de cada campo creado dinamicamente.
    evento = function (evt) { //esta funcion nos devuelve el tipo de evento disparado
       return (!evt) ? event : evt;
    }
    
    //Aqui se hace lamagia... jejeje, esta funcion crea dinamicamente los nuevos campos file
    addCampo = function () { 
    //Creamos un nuevo div para que contenga el nuevo campo
       nDiv = document.createElement('div');
    //con esto se establece la clase de la div
       nDiv.className = 'archivo';
    //este es el id de la div, aqui la utilidad de la variable numero
    //nos permite darle un id unico
       nDiv.id = 'file' + (++numero);
    //creamos el input para el formulario:
       nCampo = document.createElement('input');
    //le damos un nombre, es importante que lo nombren como vector, pues todos los campos
    //compartiran el nombre en un arreglo, asi es mas facil procesar posteriormente con php
       nCampo.name = 'archivos[]';
    //Establecemos el tipo de campo
       nCampo.type = 'file';
    //Ahora creamos un link para poder eliminar un campo que ya no deseemos
       a = document.createElement('a');
    //El link debe tener el mismo nombre de la div padre, para efectos de localizarla y eliminarla
       a.name = nDiv.id;
    //Este link no debe ir a ningun lado
       a.href = '#';
    //Establecemos que dispare esta funcion en click
       a.onclick = elimCamp;
    //Con esto ponemos el texto del link
       a.innerHTML = 'Eliminar';
    //Bien es el momento de integrar lo que hemos creado al documento,
    //primero usamos la función appendChild para adicionar el campo file nuevo
       nDiv.appendChild(nCampo);
    //Adicionamos el Link
       nDiv.appendChild(a);
    //Ahora si recuerdan, en el html hay una div cuyo id es 'adjuntos', bien
    //con esta función obtenemos una referencia a ella para usar de nuevo appendChild
    //y adicionar la div que hemos creado, la cual contiene el campo file con su link de eliminación:
       container = document.getElementById('adjuntos');
       container.appendChild(nDiv);
    }
    //con esta función eliminamos el campo cuyo link de eliminación sea presionado
    elimCamp = function (evt){
       evt = evento(evt);
       nCampo = rObj(evt);
       div = document.getElementById(nCampo.name);
       div.parentNode.removeChild(div);
    }
    //con esta función recuperamos una instancia del objeto que disparo el evento
    rObj = function (evt) { 
       return evt.srcElement ?  evt.srcElement : evt.target;
    }
    
    </script>
    {% endblock %}